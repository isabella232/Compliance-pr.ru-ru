---
title: Устойчивость данных Exchange Online в Microsoft 365
description: В этой статье найдите объяснение различных аспектов устойчивости данных в Exchange Online и Microsoft 365.
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
ms.localizationpriority: medium
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: 0e3f050c1f28fa0ca8ac89c8bb8d7151cf9cba10
ms.sourcegitcommit: 997dd3f66f65686c2e38b7e30e67add426dce5f3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2021
ms.locfileid: "58947265"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a>Exchange Online данных в Microsoft 365

>[!IMPORTANT]
>Продолжая вкладывать средства в различные способы сохранения контента почтовых ящиков, мы объявляем о завершении In-Place держит в центре администрирования Exchange (EAC) в Exchange Online. С 1 июля 2020 г. вы не сможете создавать новые In-Place holds. Но вы все равно сможете управлять In-Place в EAC или с помощью **cmdlet Set-MailboxSearch** в Exchange Online PowerShell. Однако с 1 октября 2020 г. вы не сможете управлять In-Place holds. Удалить их можно будет только в EAC или с помощью **cmdlet Remove-MailboxSearch.** Использование In-Place в Exchange Server и Exchange все равно будет поддерживаться. Дополнительные сведения об уходе из In-Place удерживается в Exchange Online см. в Exchange Online средства электронного [разоружия.](/microsoft-365/compliance/legacy-ediscovery-retirement)

Запрет на удаление позволяет сохранить все содержимое почтового ящика, в том числе удаленные элементы и исходные версии измененных элементов. Все такие элементы почтового ящика возвращаются при поиске [Обнаружение электронных данных на месте](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery). При размещении In-Place в почтовом ящике пользователя содержимое соответствующего архивного почтового ящика (если включено) также помещается на удержание и возвращается в поиске по обнаружению электронных данных.

Существует два типа коррупции, которые могут повлиять на Exchange базы данных: физическое развращение, которое обычно вызвано проблемами оборудования (в частности, оборудования хранения) и логической порчи, которая возникает из-за других факторов. Как правило, существует два типа логической коррупции, которые могут возникать в Exchange базе данных:

- **Логическое развращение** базы данных . Проверка страниц базы данных совпадает, но данные на странице неправильно логически. Это может произойти, когда двигатель базы данных (extensible служба хранилища Engine (ESE)) пытается написать страницу базы данных, и даже если операционная система возвращает сообщение о успехе, данные либо никогда не записывают на диск или они написаны в неправильном месте. Такая ситуация называется *утерянной очисткой*. ESE включает множество функций и гарантий, предназначенных для предотвращения физического повреждения базы данных и других сценариев потери данных. Чтобы предотвратить потерю потерянных флеш-данных, ESE включает механизм обнаружения потерянного флеша в базе данных вместе с функцией (восстановление одной страницы) для ее исправления.
- **Хранение логической коррупции** — данные добавляются, удаляются или манипулируют таким образом, что пользователь не ожидает. Эти случаи вызваны сторонними приложениями. Обычно это коррупция в том смысле, что пользователь рассматривает ее как коррупцию. Хранилище Exchange считает транзакцию, которая привела к логическому повреждению серией правильных операций MAPI. Функции [удержания](/exchange/security-and-compliance/create-or-remove-in-place-holds) на месте в Exchange Online обеспечивают защиту от логической коррупции магазина (так как она не позволяет постоянно удалять контент пользователем или приложением). 

Exchange Online выполняет несколько проверок согласованности для реплицируемых файлов журналов во время проверки журнала и воспроизведения журнала. Эти проверки согласованности препятствуют воспроизведению физической коррупции системой. Например, во время проверки журнала проводится проверка физической целостности, которая проверяет файл журнала и проверяет, соответствует ли проверка, записанная в файле журнала, проверке, генерируемой в памяти. Кроме того, заглавная запись файла журнала рассматривается, чтобы убедиться, что подпись файла журнала, записанная в загоне журнала, совпадает с подписью файла журнала. Во время воспроизведения журнала файл журнала подвергается дополнительному изучению. Например, в загоне базы данных также содержится подпись журнала, сравниваемая с подписью файла журнала, чтобы убедиться, что они совпадают. 

Защита от повреждения данных почтовых ящиков в Exchange Online достигается с помощью Exchange Native Data Protection , стратегии устойчивости, которая использует репликацию на уровне приложений на нескольких серверах и нескольких центрах обработки данных, а также другие функции, которые помогают защитить данные от потери из-за повреждения или по другим причинам. Эти функции включают родной функции, управляемые Корпорацией Майкрософт или Exchange Online приложения, такие как:

- [Группы доступности данных](/exchange/back-up-email)
- Исправление одного бита 
- Сканирование базы данных в Интернете 
- Lost Flush Detection 
- Восстановление одной страницы 
- Служба репликации почтовых ящиков 
- Проверка файлов журнала 
- Развертывание в гибкой файловой системе 

Дополнительные сведения о родных функций, перечисленных ранее, выберите гиперссылки и см. в следующих ниже сведениях о элементов без гиперссылки. Помимо этих родных функций, Exchange Online также включает в себя функции устойчивости к данным, которые клиенты могут управлять, например: 
- [Восстановление одного элемента (включено по умолчанию)](/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [Хранение на месте и хранение для судебного разбирательства](/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [Удаленные хранения элементов и Soft-Deleted почтовых ящиков (оба включены по умолчанию)](/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a>Группы доступности баз данных 
Каждая база данных почтовых ящиков Microsoft 365 в группе доступности базы данных [(DAG)](/exchange/back-up-email) и реплицируется в географически отдельные центра обработки данных в одном регионе. Наиболее распространенная конфигурация — четыре копии баз данных в четырех центрах обработки данных; однако в некоторых регионах меньше центра обработки данных (базы данных реплицированы в три центра обработки данных в Индии и два центра обработки данных в Австралии и Японии). Но во всех случаях каждая база данных почтовых ящиков имеет четыре копии, которые распространяются между несколькими центрами обработки данных, обеспечивая тем самым защиту данных почтовых ящиков от сбоев программного обеспечения, оборудования и даже центра обработки данных. 

Из этих четырех копий три из них настроены как высокодоступные. Четвертая копия настроена как отстает [копия базы данных](/Exchange/high-availability/manage-ha/activate-lagged-db-copies). Забитая копия базы данных не предназначена для восстановления отдельных почтовых ящиков или восстановления элементов почтовых ящиков. Его цель заключается в предоставлении механизма восстановления для редкого события системной, катастрофической логической коррупции. 

Запаздывание копий баз данных в Exchange Online настраивается с семидневным временем воспроизведения файлов журналов. Кроме того, Exchange диспетчер задержки воспроизведения позволяет динамический файл журнала играть вниз для запаздывания копий, чтобы запаздывание копий баз данных для самостоятельного восстановления и управления ростом файлов журнала. Несмотря на то, что в Exchange Online используются отставные копии баз данных, важно понимать, что они не являются гарантированной резервной копией по времени. Застойные копии баз данных в Exchange Online имеют порог доступности, как правило, около 90%, из-за периодов, когда диск с отстающим экземпляром теряется из-за сбоя диска, затормачиваемая копия становится высокодоступной копией (из-за автоматического воспроизведения), а также периодами, когда затормачиваемая копия базы данных восстанавливает очередь воспроизведения журнала. 

## <a name="transport-resilience"></a>Устойчивость транспорта 
Exchange Online включает две основные функции устойчивости транспорта: Shadow Redundancy и Safety Net. Резервное копирование теней сохраняет резервную копию сообщения во время его транзита. Сеть безопасности сохраняет резервную копию сообщения после успешной доставки сообщения. 

При избыточности теней каждый Exchange Online транспортный сервер создает копию каждого получаемого сообщения, прежде чем он признает успешное получение сообщения на сервер отправки. Это делает все сообщения в конвейере транспорта избыточными во время транзита. Если Exchange Online определяет, что исходное сообщение было потеряно во время транзита, резервная копия сообщения будет передерана. 

Сеть безопасности — это транспортная очередь, связанная со службой транспорта на сервере почтовых ящиков. В этой очереди хранятся копии сообщений, успешно обработанных сервером. Если для сбоя базы данных почтовых ящиков или сервера требуется активировать устарелую копию базы данных почтовых ящиков, сообщения в очереди "Сеть безопасности" автоматически перенаверяются в новую активную копию базы данных почтовых ящиков. Кроме того, сеть безопасности является избыточной, тем самым устраняя транспорт как единую точку сбоя. В нем используется концепция основной сети безопасности и теневой сети безопасности, в которой, если основная сеть безопасности недоступна более 12 часов, повторное представление запросов становится теневыми запросами на повторное использование, а сообщения перенаселяются из теневой сети безопасности.

Повторное повторное отправление сообщений из сети безопасности автоматически инициируется компонентом Active Manager службы репликации Microsoft Exchange, которая управляет копиями баз данных daGs и почтовых ящиков. Для повторной передачи сообщений из сети безопасности не требуется никаких действий вручную. 

## <a name="single-bit-correction"></a>Исправление одного бита 
ESE включает механизм обнаружения и устранения однофазных ошибок CRC (также известных как однофазные сальто), которые являются результатом аппаратных ошибок (и как таковой они представляют физическую коррупцию). При таких ошибках ESE автоматически корректируется и регистрируется событие в журнале событий. 

## <a name="online-database-scanning"></a>Сканирование базы данных в Интернете 
Online database scanning (also known as *database check summing)* is the process where an ESE uses a database consistency checker to read each page and check for page corruption. Основная цель заключается в обнаружении физического повреждения и потерянных флешей, которые могут не быть обнаружены транзакционными операциями. Сканирование базы данных также выполняет операции по сбою в хранилище. Пространство может быть утечек из-за сбоев, а сканирование базы данных в Интернете находит и восстанавливает потерянное пространство. Система разработана с расчетом на полное сканирование каждой базы данных раз в семь дней. 

## <a name="lost-flush-detection"></a>Lost Flush Detection 
Потерянный флеш возникает, когда операция записи базы данных, которую дисковая подсистема/операционная система вернулась по завершению, фактически не была написана на диск или была написана в неправильном расположении. Потерянные инциденты с флеш-данными могут привести к логическому развращение базы данных, поэтому для предотвращения потерянных флеш-данных в результате потерянных данных ESE включает механизм обнаружения потерянных флешов. Поскольку страницы баз данных написаны в пассивные копии, выполняется проверка потерянных флешей в активной копии. Если обнаружен потерянный флеш, ESE может отремонтировать процесс с помощью процесса исправления страниц. 

## <a name="single-page-restore"></a>Восстановление одной страницы 
Восстановление одной страницы, также известное как исправление *страниц,*— это автоматический процесс, в котором поврежденные страницы баз данных заменяются здоровыми копиями из здоровой реплики. Процесс восстановления поврежденной страницы зависит от того, является ли копия базы данных активной или пассивной. Когда активная копия базы данных сталкивается с поврежденной страницей, она может скопировать страницу из одной из реплик при условии, что страница, скопированная в ней, будет в курсе. Этот процесс выполняется путем ввода запроса страницы в поток журнала, который является основой репликации базы данных почтовых ящиков. Как только реплика сталкивается с запросом страницы, она отвечает, отправляя копию страницы в запрашиваемую копию базы данных. Восстановление одной страницы также обеспечивает асинхронный механизм связи для активного запроса страницы из реплик, даже если реплики в настоящее время находятся в автономном режиме. 

В случае повреждения в пассивной копии базы данных, в том числе отстает копия базы данных, так как эти копии всегда находятся за их активной копией, всегда безопасно скопировать любую страницу из активной копии в пассивную копию. Пассивная копия базы данных по своей природе очень доступна, поэтому во время процесса исправления страниц повторы журналов приостановлены, но копирование журналов продолжается. Пассивная копия базы данных извлекает копию поврежденной страницы из активной копии, ждет, пока файл журнала, отвечающий максимально необходимому требованию к генерации журнала, будет скопирован и проверен, а затем исправлена поврежденная страница. После исправления страницы возобновляется повтор журнала. Этот процесс является одинаковым для отстаемой копии базы данных, за исключением того, что затормагивая база данных сначала переиграет все файлы журнала, необходимые для достижения исправленного состояния. 

## <a name="mailbox-replication-service"></a>Служба репликации почтовых ящиков 
Перемещение почтовых ящиков является ключевой частью управления широкомасштабной службой электронной почты. Всегда существуют обновленные технологии и обновления оборудования и версий, поэтому наличие надежной и отлаженной системы, которая позволяет нашим инженерам выполнять эту работу, сохраняя прозрачность перемещения почтового ящика для пользователей (убедившись, что они остаются в сети на протяжении всего процесса) является ключевым и убедиться, что процесс масштабирует изящно по мере того, как почтовые ящики получают больше и больше. 

Служба репликации Exchange почтовых ящиков отвечает за перемещение почтовых ящиков между базами данных. Во время перемещения MRS выполняет проверку согласованности для всех элементов в почтовом ящике. Если обнаружена проблема согласованности, MRS исправит проблему или пропустит поврежденные элементы, тем самым удалив коррупцию из почтового ящика. 

Поскольку MRS является компонентом Exchange Online, мы можем внести изменения в ее код для решения новых форм коррупции, которые будут обнаружены в будущем. Например, если мы обнаруживаем проблему согласованности, которую MRS не может устранить, мы можем проанализировать коррупцию, изменить код MRS и устранить несоответствие (если мы понимаем, как это сделать). 

## <a name="log-file-checks"></a>Проверка файлов журнала 
Все файлы журнала транзакций, созданные Exchange базы данных, проходят несколько форм проверки согласованности. Когда создается файл журнала, первое, что делается, это создается шаблон бита, а затем выполняется серия записей журнала. Эта структура позволяет Exchange Online ряд проверок (потерянный флеш, CRC и другие проверки) для проверки каждого файла журнала, как он написан, и снова, как он реплицируется. 

## <a name="deployment-on-resilient-file-system"></a>Развертывание в гибкой файловой системе 
Чтобы предотвратить коррупцию на уровне файловой системы, Exchange Online развертывается в разделах "Устойчивая файловая система" (ReFS), чтобы обеспечить улучшенные возможности восстановления. ReFS — это файловая система в Windows Server 2012 и более поздних системах, которая призвана быть более устойчивой к повреждениям данных, тем самым максимально повышая доступность и целостность данных. В частности, ReFS вносит улучшения в обновление метаданных, что обеспечивает лучшую защиту данных и снижает случаи повреждения данных. Он также использует проверки для проверки целостности данных файлов и метаданных, обеспечивающих легкое обнаружение и устранение повреждения данных. 

Exchange Online воспользоваться несколькими преимуществами ReFS: 
- Повышение устойчивости к целостности данных означает меньше инцидентов с повреждениями данных. Уменьшение числа инцидентов с коррупцией означает меньше ненужных reseededs базы данных. 
- Проверки, работающие на метаданных, позволяющие выявлять случаи коррупции рано и более детерминитарно, что позволяет нам устранять коррупцию данных клиентов до возникновения серых сбоев в объемах данных.
- Разработан для работы с большими наборами данных — петабайтами и большими — без влияния на производительность
- Поддержка других функций, используемых Exchange Online, таких как шифрование BitLocker. 

Exchange Online также преимущества других функций ReFS: 
- **Integrity (Integrity Потоки)** — ReFS хранит данные таким образом, чтобы защитить их от многих распространенных ошибок, которые обычно могут привести к потере данных. Microsoft 365 Поиск использует integrity Потоки, чтобы помочь с ранним обнаружением повреждения диска и проверками контента файлов. Эта функция также снижает количество инцидентов коррупции, вызванных "Torn Writes" (когда операция записи не завершается из-за отключений питания и т.д.). 
- **Доступность (Salvage)** — Приоритеты reFS — доступность данных. Исторически сложилось так, что файловые системы часто подвержены повреждениям данных, которые требуют отключения системы для восстановления. Несмотря на редкий случай, если имеет место коррупция, ReFS реализует функцию salvage , которая удаляет поврежденные данные из пространства имен в живом томе и гарантирует, что хорошие данные не будут отрицательно оммеяны неотремонтируемыми поврежденными данными. Применение функции salvage и изолирование от повреждения данных для Exchange Online томов баз данных означает, что мы можем хранить не затронутые базы данных в поврежденном томе в период между временем повреждения и действиями по восстановлению. Эта структура повышает доступность баз данных, на которые обычно влияют такие проблемы с развращением дисков. 
