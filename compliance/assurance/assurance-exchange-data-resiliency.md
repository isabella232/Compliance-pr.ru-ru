---
title: Устойчивость данных Exchange Online в Microsoft 365
description: В этой статье найдите объяснение различных аспектов устойчивости данных в Exchange Online и Microsoft 365.
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: 4782cb47bcd5da86daf11f01cb3a443a9b637c49
ms.sourcegitcommit: 024137a15ab23d26cac5ec14c36f3577fd8a0cc4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/01/2021
ms.locfileid: "51497215"
---
# <a name="exchange-online-data-resiliency-in-microsoft-365"></a><span data-ttu-id="64c3a-103">Устойчивость данных Exchange Online в Microsoft 365</span><span class="sxs-lookup"><span data-stu-id="64c3a-103">Exchange Online data resiliency in Microsoft 365</span></span>

>[!IMPORTANT]
><span data-ttu-id="64c3a-104">По мере того как мы продолжаем инвестировать в различные способы сохранения контента почтовых ящиков, мы объявляем о завершении In-Place содержимого в центре администрирования Exchange (EAC) в Exchange Online.</span><span class="sxs-lookup"><span data-stu-id="64c3a-104">As we continue to invest in different ways to preserve mailbox content, we're announcing the retirement of In-Place Holds in the Exchange admin center (EAC) in Exchange Online.</span></span> <span data-ttu-id="64c3a-105">С 1 июля 2020 г. вы не сможете создавать новые In-Place holds.</span><span class="sxs-lookup"><span data-stu-id="64c3a-105">Starting July 1, 2020, you won't be able to create new In-Place Holds.</span></span> <span data-ttu-id="64c3a-106">Но вы все равно сможете управлять In-Place в EAC или с помощью **комлета Set-MailboxSearch** в Exchange Online PowerShell.</span><span class="sxs-lookup"><span data-stu-id="64c3a-106">But you'll still be able to manage In-Place Holds in the EAC or by using the **Set-MailboxSearch** cmdlet in Exchange Online PowerShell.</span></span> <span data-ttu-id="64c3a-107">Однако с 1 октября 2020 г. вы не сможете управлять In-Place holds.</span><span class="sxs-lookup"><span data-stu-id="64c3a-107">However, starting October 1, 2020, you won't be able to manage In-Place Holds.</span></span> <span data-ttu-id="64c3a-108">Удалить их можно будет только в EAC или с помощью **cmdlet Remove-MailboxSearch.**</span><span class="sxs-lookup"><span data-stu-id="64c3a-108">You'll only be able to remove them in the EAC or by using the **Remove-MailboxSearch** cmdlet.</span></span> <span data-ttu-id="64c3a-109">Использование In-Place в Exchange Server и гибридных развертываниях Exchange по-прежнему будет поддерживаться.</span><span class="sxs-lookup"><span data-stu-id="64c3a-109">Using In-Place Holds in Exchange Server and Exchange hybrid deployments will still be supported.</span></span> <span data-ttu-id="64c3a-110">Дополнительные сведения о выходе на пенсию In-Place в Exchange Online см. в сайте [Retirement of legacy eDiscovery tools.](/microsoft-365/compliance/legacy-ediscovery-retirement)</span><span class="sxs-lookup"><span data-stu-id="64c3a-110">For more information about the retirement of In-Place Holds in Exchange Online, see [Retirement of legacy eDiscovery tools](/microsoft-365/compliance/legacy-ediscovery-retirement).</span></span>

<span data-ttu-id="64c3a-111">Запрет на удаление позволяет сохранить все содержимое почтового ящика, в том числе удаленные элементы и исходные версии измененных элементов.</span><span class="sxs-lookup"><span data-stu-id="64c3a-111">An In-Place Hold preserves all mailbox content, including deleted items and original versions of modified items.</span></span> <span data-ttu-id="64c3a-112">Все такие элементы почтового ящика возвращаются при поиске [Обнаружение электронных данных на месте](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery).</span><span class="sxs-lookup"><span data-stu-id="64c3a-112">All such mailbox items are returned in an [In-Place eDiscovery](/exchange/security-and-compliance/in-place-ediscovery/in-place-ediscovery) search.</span></span> <span data-ttu-id="64c3a-113">При размещении In-Place в почтовом ящике пользователя содержимое соответствующего архивного почтового ящика (если включено) также помещается на удержание и возвращается в поиске по обнаружению электронных данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-113">When you place an In-Place Hold on a user's mailbox, the contents in the corresponding archive mailbox (if it's enabled) are also placed on hold and returned in an eDiscovery search.</span></span>

<span data-ttu-id="64c3a-114">Существует два типа коррупции, которые могут повлиять на базу данных Exchange: физическое развращение, которое обычно вызвано проблемами оборудования (в частности, оборудования хранения) и логической порчи, которая возникает из-за других факторов.</span><span class="sxs-lookup"><span data-stu-id="64c3a-114">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="64c3a-115">Как правило, в базе данных Exchange могут возникать два типа логической коррупции:</span><span class="sxs-lookup"><span data-stu-id="64c3a-115">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span>

- <span data-ttu-id="64c3a-116">**Логическое развращение** базы данных . Проверка страниц базы данных совпадает, но данные на странице неправильно логически.</span><span class="sxs-lookup"><span data-stu-id="64c3a-116">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="64c3a-117">Это может произойти, когда двигатель базы данных (extensible Storage Engine (ESE)) пытается написать страницу базы данных, и даже несмотря на то, что операционная система возвращает сообщение о успехе, данные либо никогда не записывают на диск или они написаны в неправильном месте.</span><span class="sxs-lookup"><span data-stu-id="64c3a-117">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="64c3a-118">Такая ситуация называется *утерянной очисткой*.</span><span class="sxs-lookup"><span data-stu-id="64c3a-118">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="64c3a-119">ESE включает множество функций и гарантий, предназначенных для предотвращения физического повреждения базы данных и других сценариев потери данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-119">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="64c3a-120">Чтобы предотвратить потерю потерянных флеш-данных, ESE включает механизм обнаружения потерянного флеша в базе данных вместе с функцией (восстановление одной страницы) для ее исправления.</span><span class="sxs-lookup"><span data-stu-id="64c3a-120">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span>
- <span data-ttu-id="64c3a-121">**Хранение логической коррупции** — данные добавляются, удаляются или манипулируют таким образом, что пользователь не ожидает.</span><span class="sxs-lookup"><span data-stu-id="64c3a-121">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="64c3a-122">Эти случаи вызваны сторонними приложениями.</span><span class="sxs-lookup"><span data-stu-id="64c3a-122">These cases are caused by third-party applications.</span></span> <span data-ttu-id="64c3a-123">Обычно это коррупция в том смысле, что пользователь рассматривает ее как коррупцию.</span><span class="sxs-lookup"><span data-stu-id="64c3a-123">It's usually corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="64c3a-124">Хранилище Exchange считает транзакцию, которая привела к логическому повреждению серией правильных операций MAPI.</span><span class="sxs-lookup"><span data-stu-id="64c3a-124">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="64c3a-125">Функции [удержания](/exchange/security-and-compliance/create-or-remove-in-place-holds) на месте в Exchange Online обеспечивают защиту от логической коррупции магазина (так как она предотвращает постоянное удаление контента пользователем или приложением).</span><span class="sxs-lookup"><span data-stu-id="64c3a-125">The [In-Place Hold](/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="64c3a-126">Exchange Online выполняет несколько проверок согласованности для реплицируемых файлов журнала во время проверки журнала и воспроизведения журнала.</span><span class="sxs-lookup"><span data-stu-id="64c3a-126">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="64c3a-127">Эти проверки согласованности препятствуют воспроизведению физической коррупции системой.</span><span class="sxs-lookup"><span data-stu-id="64c3a-127">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="64c3a-128">Например, во время проверки журнала проводится проверка физической целостности, которая проверяет файл журнала и проверяет, соответствует ли проверка, записанная в файле журнала, проверке, генерируемой в памяти.</span><span class="sxs-lookup"><span data-stu-id="64c3a-128">For example, during log inspection, there is a physical integrity check that verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="64c3a-129">Кроме того, заглавная запись файла журнала рассматривается, чтобы убедиться, что подпись файла журнала, записанная в загоне журнала, совпадает с подписью файла журнала.</span><span class="sxs-lookup"><span data-stu-id="64c3a-129">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="64c3a-130">Во время воспроизведения журнала файл журнала подвергается дополнительному изучению.</span><span class="sxs-lookup"><span data-stu-id="64c3a-130">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="64c3a-131">Например, в загоне базы данных также содержится подпись журнала, сравниваемая с подписью файла журнала, чтобы убедиться, что они совпадают.</span><span class="sxs-lookup"><span data-stu-id="64c3a-131">For example, the database header also contains the log signature that is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="64c3a-132">Защита от повреждения данных почтовых ящиков в Exchange Online достигается с помощью Exchange Native Data Protection , стратегии устойчивости, которая использует репликацию на уровне приложений на нескольких серверах и нескольких центрах обработки данных, а также другие функции, которые помогают защитить данные от потери из-за коррупции или по другим причинам.</span><span class="sxs-lookup"><span data-stu-id="64c3a-132">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="64c3a-133">Эти функции включают в себя родной функции, которые управляются Корпорацией Майкрософт или приложением Exchange Online, например:</span><span class="sxs-lookup"><span data-stu-id="64c3a-133">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="64c3a-134">Группы доступности данных</span><span class="sxs-lookup"><span data-stu-id="64c3a-134">Data Availability Groups</span></span>](/exchange/back-up-email)
- <span data-ttu-id="64c3a-135">Исправление одного бита</span><span class="sxs-lookup"><span data-stu-id="64c3a-135">Single Bit Correction</span></span> 
- <span data-ttu-id="64c3a-136">Сканирование базы данных в Интернете</span><span class="sxs-lookup"><span data-stu-id="64c3a-136">Online Database Scanning</span></span> 
- <span data-ttu-id="64c3a-137">Lost Flush Detection</span><span class="sxs-lookup"><span data-stu-id="64c3a-137">Lost Flush Detection</span></span> 
- <span data-ttu-id="64c3a-138">Восстановление одной страницы</span><span class="sxs-lookup"><span data-stu-id="64c3a-138">Single Page Restore</span></span> 
- <span data-ttu-id="64c3a-139">Служба репликации почтовых ящиков</span><span class="sxs-lookup"><span data-stu-id="64c3a-139">Mailbox Replication Service</span></span> 
- <span data-ttu-id="64c3a-140">Проверка файлов журнала</span><span class="sxs-lookup"><span data-stu-id="64c3a-140">Log File Checks</span></span> 
- <span data-ttu-id="64c3a-141">Развертывание в гибкой файловой системе</span><span class="sxs-lookup"><span data-stu-id="64c3a-141">Deployment on Resilient File System</span></span> 

<span data-ttu-id="64c3a-142">Дополнительные сведения о родных функций, перечисленных ранее, выберите гиперссылки и см. в следующих ниже сведениях о элементов без гиперссылки.</span><span class="sxs-lookup"><span data-stu-id="64c3a-142">For more information on the native features listed previously, select the hyperlinks, and see the following for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="64c3a-143">Помимо этих родных функций, Exchange Online также включает функции устойчивости к данным, которые клиенты могут управлять, например:</span><span class="sxs-lookup"><span data-stu-id="64c3a-143">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="64c3a-144">Восстановление одного элемента (включено по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="64c3a-144">Single Item Recovery (enabled by default)</span></span>](/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="64c3a-145">Хранение на месте и хранение для судебного разбирательства</span><span class="sxs-lookup"><span data-stu-id="64c3a-145">In-Place Hold and Litigation Hold</span></span>](/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="64c3a-146">Удаленные хранения элементов и Soft-Deleted почтовых ящиков (оба включены по умолчанию)</span><span class="sxs-lookup"><span data-stu-id="64c3a-146">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="64c3a-147">Группы доступности баз данных</span><span class="sxs-lookup"><span data-stu-id="64c3a-147">Database Availability Groups</span></span> 
<span data-ttu-id="64c3a-148">Каждая база данных почтовых ящиков в Microsoft 365 расположена в группе доступности базы данных [(DAG)](/exchange/back-up-email) и реплицируется в географически отдельные центра обработки данных в том же регионе.</span><span class="sxs-lookup"><span data-stu-id="64c3a-148">Every mailbox database in Microsoft 365 is hosted in a [database availability group (DAG)](/exchange/back-up-email) and replicated to geographically separate datacenters within the same region.</span></span> <span data-ttu-id="64c3a-149">Наиболее распространенная конфигурация — четыре копии баз данных в четырех центрах обработки данных; однако в некоторых регионах меньше центра обработки данных (базы данных реплицированы в три центра обработки данных в Индии и два центра обработки данных в Австралии и Японии).</span><span class="sxs-lookup"><span data-stu-id="64c3a-149">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="64c3a-150">Но во всех случаях каждая база данных почтовых ящиков имеет четыре копии, которые распространяются между несколькими центрами обработки данных, обеспечивая тем самым защиту данных почтовых ящиков от сбоев программного обеспечения, оборудования и даже центра обработки данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-150">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="64c3a-151">Из этих четырех копий три из них настроены как высокодоступные.</span><span class="sxs-lookup"><span data-stu-id="64c3a-151">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="64c3a-152">Четвертая копия настроена как отстает [копия базы данных](/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span><span class="sxs-lookup"><span data-stu-id="64c3a-152">The fourth copy is configured as a [lagged database copy](/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="64c3a-153">Забитая копия базы данных не предназначена для восстановления отдельных почтовых ящиков или восстановления элементов почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="64c3a-153">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="64c3a-154">Его цель заключается в предоставлении механизма восстановления для редкого события системной, катастрофической логической коррупции.</span><span class="sxs-lookup"><span data-stu-id="64c3a-154">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="64c3a-155">Запаздывание копий баз данных в Exchange Online настраивается с семидневным временем задержки воспроизведения файлов журналов.</span><span class="sxs-lookup"><span data-stu-id="64c3a-155">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="64c3a-156">Кроме того, диспетчер задержки воспроизведения Exchange позволяет динамическим файлам журнала отыгрываться для отстает копии, чтобы позволить отстает копий базы данных для самостоятельного восстановления и управления ростом файла журнала.</span><span class="sxs-lookup"><span data-stu-id="64c3a-156">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="64c3a-157">Хотя в Exchange Online используются забитые копии баз данных, важно понимать, что они не являются гарантированной резервной копией по времени.</span><span class="sxs-lookup"><span data-stu-id="64c3a-157">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="64c3a-158">Застойные копии баз данных в Exchange Online имеют порог доступности, как правило, около 90%, из-за периодов, когда диск с отстающим экземпляром теряется из-за сбоя диска, затормаживая копия становится доступной копией (из-за автоматического воспроизведения), а также периодами, в которых отстает копия базы данных, восстанавливая очередь воспроизведения журнала.</span><span class="sxs-lookup"><span data-stu-id="64c3a-158">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly available copy (due to automatic play down), as well as the periods where the lagged database copy is rebuilding the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="64c3a-159">Устойчивость транспорта</span><span class="sxs-lookup"><span data-stu-id="64c3a-159">Transport Resilience</span></span> 
<span data-ttu-id="64c3a-160">Exchange Online включает две основные функции устойчивости транспорта: Shadow Redundancy и Safety Net.</span><span class="sxs-lookup"><span data-stu-id="64c3a-160">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="64c3a-161">Резервное копирование теней сохраняет резервную копию сообщения во время его транзита.</span><span class="sxs-lookup"><span data-stu-id="64c3a-161">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="64c3a-162">Сеть безопасности сохраняет резервную копию сообщения после успешной доставки сообщения.</span><span class="sxs-lookup"><span data-stu-id="64c3a-162">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="64c3a-163">При избыточности теней каждый транспортный сервер Exchange Online создает копию каждого получаемого сообщения, прежде чем он признает успешное получение сообщения на сервер отправки.</span><span class="sxs-lookup"><span data-stu-id="64c3a-163">With Shadow Redundancy, each Exchange Online transport server makes a copy of each message it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="64c3a-164">Это делает все сообщения в конвейере транспорта избыточными во время транзита.</span><span class="sxs-lookup"><span data-stu-id="64c3a-164">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="64c3a-165">Если Exchange Online определяет, что исходное сообщение было потеряно при транзите, резервная копия сообщения будет передерана.</span><span class="sxs-lookup"><span data-stu-id="64c3a-165">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="64c3a-166">Сеть безопасности — это транспортная очередь, связанная со службой транспорта на сервере почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="64c3a-166">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="64c3a-167">В этой очереди хранятся копии сообщений, успешно обработанных сервером.</span><span class="sxs-lookup"><span data-stu-id="64c3a-167">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="64c3a-168">Если для сбоя базы данных почтовых ящиков или сервера требуется активировать устарелую копию базы данных почтовых ящиков, сообщения в очереди "Сеть безопасности" автоматически перенаверяются в новую активную копию базы данных почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="64c3a-168">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="64c3a-169">Кроме того, сеть безопасности является избыточной, тем самым устраняя транспорт как единую точку сбоя.</span><span class="sxs-lookup"><span data-stu-id="64c3a-169">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="64c3a-170">В нем используется концепция основной сети безопасности и теневой сети безопасности, в которой, если основная сеть безопасности недоступна более 12 часов, повторное представление запросов становится теневыми запросами на повторное использование, а сообщения перенаселяются из теневой сети безопасности.</span><span class="sxs-lookup"><span data-stu-id="64c3a-170">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are redelivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="64c3a-171">Повторное отправление сообщений из сети безопасности автоматически инициируется компонентом Active Manager службы репликации Microsoft Exchange, которая управляет копиями баз данных daGs и почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="64c3a-171">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="64c3a-172">Для повторной передачи сообщений из сети безопасности не требуется никаких действий вручную.</span><span class="sxs-lookup"><span data-stu-id="64c3a-172">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="64c3a-173">Исправление одного бита</span><span class="sxs-lookup"><span data-stu-id="64c3a-173">Single Bit Correction</span></span> 
<span data-ttu-id="64c3a-174">ESE включает механизм обнаружения и устранения однофазных ошибок CRC (также известных как однофазные сальто), которые являются результатом аппаратных ошибок (и как таковой они представляют физическую коррупцию).</span><span class="sxs-lookup"><span data-stu-id="64c3a-174">ESE includes a mechanism to detect and resolve single-bit CRC errors (also known as single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="64c3a-175">При таких ошибках ESE автоматически корректируется и регистрируется событие в журнале событий.</span><span class="sxs-lookup"><span data-stu-id="64c3a-175">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="64c3a-176">Сканирование базы данных в Интернете</span><span class="sxs-lookup"><span data-stu-id="64c3a-176">Online Database Scanning</span></span> 
<span data-ttu-id="64c3a-177">Online database scanning (also known as *database check summing)* is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span><span class="sxs-lookup"><span data-stu-id="64c3a-177">Online database scanning (also known as *database check summing*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="64c3a-178">Основная цель заключается в обнаружении физического повреждения и потерянных флешей, которые могут не быть обнаружены транзакционными операциями.</span><span class="sxs-lookup"><span data-stu-id="64c3a-178">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="64c3a-179">Сканирование базы данных также выполняет операции по сбою в хранилище.</span><span class="sxs-lookup"><span data-stu-id="64c3a-179">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="64c3a-180">Пространство может быть утечек из-за сбоев, а сканирование базы данных в Интернете находит и восстанавливает потерянное пространство.</span><span class="sxs-lookup"><span data-stu-id="64c3a-180">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="64c3a-181">Система разработана с расчетом на полное сканирование каждой базы данных раз в семь дней.</span><span class="sxs-lookup"><span data-stu-id="64c3a-181">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="64c3a-182">Lost Flush Detection</span><span class="sxs-lookup"><span data-stu-id="64c3a-182">Lost Flush Detection</span></span> 
<span data-ttu-id="64c3a-183">Потерянный флеш возникает, когда операция записи базы данных, которую дисковая подсистема/операционная система вернулась по завершению, фактически не была написана на диск или была написана в неправильном расположении.</span><span class="sxs-lookup"><span data-stu-id="64c3a-183">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="64c3a-184">Потерянные инциденты с флеш-данными могут привести к логическому развращение базы данных, поэтому для предотвращения потерянных флеш-данных в результате потерянных данных ESE включает механизм обнаружения потерянных флешов.</span><span class="sxs-lookup"><span data-stu-id="64c3a-184">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="64c3a-185">Поскольку страницы баз данных написаны в пассивные копии, выполняется проверка потерянных флешей в активной копии.</span><span class="sxs-lookup"><span data-stu-id="64c3a-185">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="64c3a-186">Если обнаружен потерянный флеш, ESE может отремонтировать процесс с помощью процесса исправления страниц.</span><span class="sxs-lookup"><span data-stu-id="64c3a-186">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="64c3a-187">Восстановление одной страницы</span><span class="sxs-lookup"><span data-stu-id="64c3a-187">Single Page Restore</span></span> 
<span data-ttu-id="64c3a-188">Восстановление одной страницы, также известное как исправление *страниц,*— это автоматический процесс, в котором поврежденные страницы баз данных заменяются здоровыми копиями из здоровой реплики.</span><span class="sxs-lookup"><span data-stu-id="64c3a-188">Single page restore, also known as *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="64c3a-189">Процесс восстановления поврежденной страницы зависит от того, является ли копия базы данных активной или пассивной.</span><span class="sxs-lookup"><span data-stu-id="64c3a-189">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="64c3a-190">Когда активная копия базы данных сталкивается с поврежденной страницей, она может скопировать страницу из одной из реплик при условии, что страница, скопированная в ней, будет в курсе.</span><span class="sxs-lookup"><span data-stu-id="64c3a-190">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is up to date.</span></span> <span data-ttu-id="64c3a-191">Этот процесс выполняется путем ввода запроса страницы в поток журнала, который является основой репликации базы данных почтовых ящиков.</span><span class="sxs-lookup"><span data-stu-id="64c3a-191">This process is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="64c3a-192">Как только реплика сталкивается с запросом страницы, она отвечает, отправляя копию страницы в запрашиваемую копию базы данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-192">As soon as a replica encounters the page request, it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="64c3a-193">Восстановление одной страницы также обеспечивает асинхронный механизм связи для активного запроса страницы из реплик, даже если реплики в настоящее время находятся в автономном режиме.</span><span class="sxs-lookup"><span data-stu-id="64c3a-193">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="64c3a-194">В случае повреждения в пассивной копии базы данных, в том числе отстает копия базы данных, так как эти копии всегда находятся за их активной копией, всегда безопасно скопировать любую страницу из активной копии в пассивную копию.</span><span class="sxs-lookup"><span data-stu-id="64c3a-194">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="64c3a-195">Пассивная копия базы данных по своей природе очень доступна, поэтому во время процесса исправления страниц повторы журналов приостановлены, но копирование журналов продолжается.</span><span class="sxs-lookup"><span data-stu-id="64c3a-195">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="64c3a-196">Пассивная копия базы данных извлекает копию поврежденной страницы из активной копии, ждет, пока файл журнала, отвечающий максимально необходимому требованию к генерации журнала, будет скопирован и проверен, а затем исправлена поврежденная страница.</span><span class="sxs-lookup"><span data-stu-id="64c3a-196">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file that meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="64c3a-197">После исправления страницы возобновляется повтор журнала.</span><span class="sxs-lookup"><span data-stu-id="64c3a-197">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="64c3a-198">Этот процесс является одинаковым для отстаемой копии базы данных, за исключением того, что затормагивая база данных сначала переиграет все файлы журнала, необходимые для достижения исправленного состояния.</span><span class="sxs-lookup"><span data-stu-id="64c3a-198">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="64c3a-199">Служба репликации почтовых ящиков</span><span class="sxs-lookup"><span data-stu-id="64c3a-199">Mailbox Replication Service</span></span> 
<span data-ttu-id="64c3a-200">Перемещение почтовых ящиков является ключевой частью управления широкомасштабной службой электронной почты.</span><span class="sxs-lookup"><span data-stu-id="64c3a-200">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="64c3a-201">Всегда существуют обновленные технологии и обновления оборудования и версий, поэтому наличие надежной и отлаженной системы, которая позволяет нашим инженерам выполнять эту работу, сохраняя прозрачность перемещения почтового ящика для пользователей (убедившись, что они остаются в сети на протяжении всего процесса) является ключевым и убедиться, что процесс масштабирует изящно по мере того, как почтовые ящики получают больше и больше.</span><span class="sxs-lookup"><span data-stu-id="64c3a-201">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="64c3a-202">Служба репликации почтовых ящиков Exchange (MRS) отвечает за перемещение почтовых ящиков между базами данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-202">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="64c3a-203">Во время перемещения MRS выполняет проверку согласованности для всех элементов в почтовом ящике.</span><span class="sxs-lookup"><span data-stu-id="64c3a-203">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="64c3a-204">Если обнаружена проблема согласованности, MRS исправит проблему или пропустит поврежденные элементы, тем самым удалив коррупцию из почтового ящика.</span><span class="sxs-lookup"><span data-stu-id="64c3a-204">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="64c3a-205">Поскольку MRS является компонентом Exchange Online, мы можем внести изменения в код, чтобы решить новые формы коррупции, которые будут обнаружены в будущем.</span><span class="sxs-lookup"><span data-stu-id="64c3a-205">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="64c3a-206">Например, если мы обнаруживаем проблему согласованности, которую MRS не может устранить, мы можем проанализировать коррупцию, изменить код MRS и устранить несоответствие (если мы понимаем, как это сделать).</span><span class="sxs-lookup"><span data-stu-id="64c3a-206">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="64c3a-207">Проверка файлов журнала</span><span class="sxs-lookup"><span data-stu-id="64c3a-207">Log File Checks</span></span> 
<span data-ttu-id="64c3a-208">Все файлы журнала транзакций, созданные базой данных Exchange, проходят несколько форм проверки согласованности.</span><span class="sxs-lookup"><span data-stu-id="64c3a-208">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="64c3a-209">Когда создается файл журнала, первое, что делается, это создается шаблон бита, а затем выполняется серия записей журнала.</span><span class="sxs-lookup"><span data-stu-id="64c3a-209">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="64c3a-210">Эта структура позволяет Exchange Online выполнять серию проверок (потерянный флеш, CRC и другие проверки) для проверки каждого файла журнала по мере его записи и повторного копирования.</span><span class="sxs-lookup"><span data-stu-id="64c3a-210">This structure enables Exchange Online to execute a series of checks (lost flush, CRC, and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="64c3a-211">Развертывание в гибкой файловой системе</span><span class="sxs-lookup"><span data-stu-id="64c3a-211">Deployment on Resilient File System</span></span> 
<span data-ttu-id="64c3a-212">Чтобы предотвратить коррупцию на уровне файловой системы, Exchange Online развертывается в разделах "Устойчивая файловая система" (ReFS), чтобы обеспечить улучшенные возможности восстановления.</span><span class="sxs-lookup"><span data-stu-id="64c3a-212">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="64c3a-213">ReFS — это файловая система в Windows Server 2012 и более поздней версии, которая призвана быть более устойчивой к повреждениям данных, тем самым максимально повышая доступность и целостность данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-213">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="64c3a-214">В частности, ReFS вносит улучшения в обновление метаданных, что обеспечивает лучшую защиту данных и снижает случаи повреждения данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-214">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="64c3a-215">Он также использует проверки для проверки целостности данных файлов и метаданных, обеспечивающих легкое обнаружение и устранение повреждения данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-215">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="64c3a-216">Exchange Online воспользовался несколькими преимуществами ReFS:</span><span class="sxs-lookup"><span data-stu-id="64c3a-216">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="64c3a-217">Повышение устойчивости к целостности данных означает меньше инцидентов с повреждениями данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-217">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="64c3a-218">Уменьшение числа инцидентов с коррупцией означает меньше ненужных reseededs базы данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-218">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="64c3a-219">Проверки, работающие на метаданных, позволяющие выявлять случаи коррупции рано и более детерминитарно, что позволяет нам устранять коррупцию данных клиентов до возникновения серых сбоев в объемах данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-219">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="64c3a-220">Разработан для работы с большими наборами данных — петабайтами и большими — без влияния на производительность</span><span class="sxs-lookup"><span data-stu-id="64c3a-220">Designed to work well with large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="64c3a-221">Поддержка других функций, используемых Exchange Online, таких как шифрование BitLocker.</span><span class="sxs-lookup"><span data-stu-id="64c3a-221">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="64c3a-222">Exchange Online также может использовать другие функции ReFS:</span><span class="sxs-lookup"><span data-stu-id="64c3a-222">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="64c3a-223">**Integrity (Integrity Streams)** — ReFS хранит данные таким образом, чтобы защитить их от многих распространенных ошибок, которые обычно могут привести к потере данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-223">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="64c3a-224">В Microsoft 365 Search используются потоки целостности для раннего обнаружения порчи дисков и проверки контента файлов.</span><span class="sxs-lookup"><span data-stu-id="64c3a-224">Microsoft 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="64c3a-225">Эта функция также снижает количество инцидентов коррупции, вызванных "Torn Writes" (когда операция записи не завершается из-за отключения электроэнергии и т.д.).</span><span class="sxs-lookup"><span data-stu-id="64c3a-225">The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="64c3a-226">**Доступность (Salvage)** — Приоритеты reFS — доступность данных.</span><span class="sxs-lookup"><span data-stu-id="64c3a-226">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="64c3a-227">Исторически сложилось так, что файловые системы часто подвержены повреждениям данных, которые требуют отключения системы для восстановления.</span><span class="sxs-lookup"><span data-stu-id="64c3a-227">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="64c3a-228">Несмотря на редкий случай, если имеет место коррупция, ReFS реализует функцию salvage , которая удаляет поврежденные данные из пространства имен в живом томе и гарантирует, что хорошие данные не будут отрицательно оммеяны неотремонтируемыми поврежденными данными.</span><span class="sxs-lookup"><span data-stu-id="64c3a-228">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="64c3a-229">Применение функции salvage и изолирование отвращение данных к объемам баз данных Exchange Online означает, что мы можем хранить не затронутые базы данных в поврежденном томе в период между временем повреждения и действиями по восстановлению.</span><span class="sxs-lookup"><span data-stu-id="64c3a-229">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="64c3a-230">Эта структура повышает доступность баз данных, на которые обычно влияют такие проблемы с развращением дисков.</span><span class="sxs-lookup"><span data-stu-id="64c3a-230">This structure increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 
