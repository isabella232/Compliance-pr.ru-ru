---
title: Microsoft 365 Exchange Online удаления данных
description: Узнайте, как мягкие и жесткие удаления данных для почтовых ящиков и элементов в почтовых ящиках обрабатываются в Exchange Online.
ms.author: robmazz
author: robmazz
manager: laurawi
ms.reviewer: sosstah
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
ms.localizationpriority: medium
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
- MS-Compliance
f1.keywords:
- NOCSH
ms.custom: seo-marvel-apr2020
titleSuffix: Microsoft Service Assurance
hideEdit: true
ms.openlocfilehash: 9dd365e075226d8fdbfd1a9f9e371df2668f814d
ms.sourcegitcommit: 4c00fd65d418065d7f53216c91f455ccb3891c77
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/23/2021
ms.locfileid: "58481991"
---
# <a name="exchange-online-data-deletion-in-microsoft-365"></a>Exchange Online удаления данных в Microsoft 365

В Exchange Online существует два типа удалений: мягкие удаления и жесткие удаления. Это касается как почтовых ящиков, так и элементов в почтовом ящике.

## <a name="soft-deleted-and-hard-deleted-mailboxes"></a>Удаленные и трудно удаленные почтовые ящики

Удаленный электронный почтовый ящик — это почтовый ящик, удаленный с помощью Центр администрирования Microsoft 365 или Remove-Mailbox и до сих пор находится в корзине Azure Active Directory менее 30 дней. Почтовый ящик может быть удален в любом из следующих способов:

- Связанная с почтовым ящиком учетная запись пользователя Azure Active Directory удалена (объект пользователя находится вне области или находится в контейнере корзины для повторной переработки).
- Связанная учетная запись Azure Active Directory почтового ящика пользователя была удалена с трудом, но Exchange Online находится под удержанием судебного разбирательства или удержанием электронных данных.
- Связанная учетная запись Azure Active Directory почтового ящика пользователя была стерта в течение последних 30 дней; которая является максимальной продолжительностью хранения Exchange Online будет хранить почтовый ящик в мягком удалении до его постоянного удаления и невозвратного.

Удаленный почтовый ящик — это почтовый ящик, удаленный одним из следующих способов:

- Почтовый ящик пользователя был удален более 30 дней, а связанный с ним Azure Active Directory был удален с трудом. Все содержимое почтовых ящиков, такие как сообщения электронной почты, контакты и файлы, удаляются навсегда.
- Учетная запись пользователя, связанная с почтовым ящиком пользователя, была удалена из Azure Active Directory. Теперь почтовый ящик пользователя удален в Exchange Online и остается в мягком удалении в течение 30 дней. Если в 30-дневный период новый Azure Active Directory синхронизируется с исходной учетной записью получателя с тем же **ExchangeGuid или ArchiveGuid,** и эта новая учетная запись лицензирована для Exchange Online, это приведет к жесткому удалению исходного почтового ящика пользователя.  Все содержимое почтовых ящиков, такие как сообщения электронной почты, контакты и файлы, удаляются навсегда.
- Электронный почтовый ящик удаляется с помощью **Remove-Mailbox -PermanentlyDelete.**

В вышеуказанных сценариях удаления предполагается, что почтовый ящик пользователя не в любом из состояниях удержания, как удержание судебного разбирательства или удержание электронных данных. Если в почтовом ящике есть какой-либо тип удержания, почтовый ящик не может быть удален. Для всех типов получателей почты любые параметры [hold](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US) игнорируются и не влияют на жесткие удаления или мягкие удаления.

## <a name="soft-deleted-and-hard-deleted-items"></a>Элементы с мягким удалением и жесткой удаленностью

Когда пользователь удаляет элемент почтового ящика (например, сообщение электронной почты, контакт, назначение календаря или задачу), элемент перемещается в папку "Извлекаемые элементы" и в подмостки с именем "Deletions". Это называется мягким удалением. Срок хранения удаленных элементов в папке Удаленные зависит от периода хранения удаленных элементов, настроенного для почтового ящика. Почтовый Exchange Online по умолчанию сохраняет удаленные элементы в течение 14 дней, но Exchange Online администраторы могут изменить этот параметр, чтобы увеличить период до 30 дней. (Подробные действия по увеличению периода хранения удаленных элементов для почтового ящика Exchange Online см. в статье Изменение срока хранения постоянно удаленных элементов для Exchange Online почтового [ящика.)](/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention) Пользователи могут восстанавливать или очищать удаленные элементы до истечения срока хранения удаленных элементов. Для этого они используют функцию Восстановление удаленных элементов в Microsoft Outlook или Outlook в Интернете.

Если пользователь очищает удаленный элемент с помощью функции Восстановление удаленных элементов в Outlook или Outlook в Интернете, это называется жесткое удаление. В Exchange Online по умолчанию по умолчанию включено восстановление одного элемента, поэтому администратор [](/Exchange/recipients/user-mailboxes/recover-deleted-messages) может восстановить удаленные элементы до истечения срока хранения удаленных элементов. Кроме того, если сообщение изменено пользователем или процессом, копии исходного элемента также сохраняются при включении восстановления одного элемента.

## <a name="page-zeroing"></a>Обнуление страницы

*Обнуление* — это механизм безопасности, который записывает нули или двоичный шаблон над удаленными данными, чтобы восстановить удаленные данные было сложнее. В Exchange Online базы данных почтовых  ящиков используют страницы в качестве единицы хранилища и реализуют процесс переописывания, называемый *обнуление страниц.* Обнуление страницы включено по умолчанию и не может быть отключено клиентами или Корпорацией Майкрософт. Операции обнуля страниц записывают в файлы журнала транзакций, чтобы все копии данной базы данных были обнуляются аналогичным образом. Обнуление страницы на активной копии базы данных приводит к обнуляемой странице пассивных копий базы данных.

Обнуление страницы записывает двоичный шаблон над трудно удаленными записями. Шаблон обнуления страниц специфичен для операций extensible служба хранилища Engine (ESE) (имя внутреннего двигателя базы данных, используемого серверами в Exchange Online), и отличается для операций по обслуживанию фоновой базы данных. (Обслуживание базы данных фона — это процесс, который непрерывно проверяет и сканирует каждую базу данных. Его основная функция — проверка страниц баз данных, но она также обрабатывает очистку пространства и обнуление записей и страниц, которые не были обнуляются из-за сбоя в магазине.)

В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям среды выполнения.

| Операция среды выполнения ESE   | Шаблон заполнения |
|--------------------------|--------------|
| Заменить                  | R            |
| Удалить запись или длинное значение | D            |
| Освобожденное место страницы         | H            |

В следующей таблице перечислены шаблоны заполнения, соответствующие определенным операциям, выполняемым во время фонового обслуживания базы данных ESE.

| Операция фонового обслуживания базы данных ESE | Шаблон заполнения |
|-----------------------------------------------|--------------|
| Удалить запись                                 | D            |
| Удалить длинное значение                             | L            |
| Освобожденное место частично используемой страницы       | Z            |
| Освобожденное место неиспользуемой страницы               | U            |

### <a name="page-zeroing-process"></a>Процесс обнуля страницы

Процесс обнуления страниц зависит от сценария удаления. В следующей таблице описаны сценарии удаления базы данных и случаи выполнения функций обнуления страниц.

| Сценарий удаления базы данных | Процесс ESE и временные рамки обнуления данных в базе данных |
|:--------------------------|:------------------------------------------------|
| Срок действия элемента истекает в зависимости от периода хранения удаленных элементов. | В асинхронном потоке двоичный шаблон записывается поверх удаленных данных. Это действие выполняется за те миллисекунды, в течение которых происходит удаление записи. Если процесс Store сбоя, пока работа по асинхронному обнулении еще не выполнена (или очистка магазина версий отменяется из-за роста магазина версий), обнуление завершится, когда фоновое обслуживание базы данных обрабатывает этот раздел базы данных. |
| Просмотр сценария: истечение срока действия элементов из Outlook/Outlook в Интернете папки (например, представление беседы) | Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных. |
| Перемещение сценария почтовых ящиков и удаления почтовых ящиков: исходный почтовый ящик удален (истек срок действия удаленного почтового ящика) | Обнуление данных выполняется при обработке этого раздела базы данных во время фонового обслуживания базы данных. |

### <a name="mailbox-data-types-without-page-zeroing"></a>Типы данных почтовых ящиков без обнуление страниц

В следующих типах данных почтовых ящиков нет положений обнуление страниц:

- **Журналы** транзакций баз данных почтовых ящиков . При удалении журналов транзакций в рамках обычных операций процесс обнуления блоков в файловой системе, хранимой удаленный файл журнала(ы). Вполне вероятно, что файловая система быстро повторит это свободное пространство для вновь созданных журналов, но нет никакой гарантии, что это произойдет.
- **Файлы каталога** индекса контента — Exchange Online для функции индексации поиска используется Фонд поиска (также известный как FAST). Каталог индекса поиска состоит из нескольких десятков файлов, хранимых в том же объеме, что и файл базы данных почтовых ящиков. При необратимом удалении сообщения из базы данных почтовых ящиков связанное с ним содержимое в каталоге поиска не удаляется в тот же момент. Удаление контента происходит, когда Фонд поиска делает теневое (или мастер-слияние) многих небольших файлов каталога в одном большом файле. После завершения основного объединения файлы каталога меньшего размера удаляются. Не требуется обнулять блоки, хранимые удаленные файлы каталога.

## <a name="continuous-replication"></a>Непрерывная репликация

Непрерывная репликация (также известная как доставка журналов и воспроизведение) — это технология в Exchange Online, которая создает и поддерживает копии каждой базы данных почтовых ящиков для обеспечения высокой доступности, устойчивости сайта и аварийного восстановления. Непрерывная репликация Exchange Server поддержку аварийного восстановления базы данных для предоставления технологии, которая выполняет асинхронное обновление одной или более копий базы данных почтовых ящиков. Каждый сервер почтовых ящиков записи обновлений базы данных, сделанных в активной базе данных (например, активность электронной почты пользователя) в качестве записей журнала в последовательном наборе 1-МБ файлов журнала транзакций. Этот набор файлов называется потоком журналов. В непрерывной репликации поток журналов также используется для асинхронного обновления одной или более копий базы данных. Это достигается путем передачи журналов в расположение, содержащее пассивную копию активной базы данных, а затем их воспроизведение в пассивную копию базы данных. Если все журналы из активной базы данных переигровываться с пассивной копией базы данных, то эти две базы данных эквивалентны, и именно в этом процессе все физические изменения, сделанные в активной базе данных, реплицированы во все пассивные копии этой базы данных.

Любое удаление из базы данных почтовых ящиков, будь то элемент почтового ящика или весь почтовый ящик, а также мягкое удаление или жесткое удаление, представляет физическое изменение активной базы данных. Обнуление страницы также предполагает внесение физических изменений в активную базу данных. Эти изменения пишутся в файлах журнала в процессе, называемом непрерывной репликацией, и когда эти файлы журнала переигровывалися с пассивными копиями базы данных, в эти пассивные базы данных внося те же физические изменения.
